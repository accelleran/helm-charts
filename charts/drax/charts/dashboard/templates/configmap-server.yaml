{{- include
      "accelleran.common.configMap"
      (fromYaml (include "accelleran.dashboard.configMap.server.args" .))
-}}

{{- define "accelleran.dashboard.configMap.server.args" -}}
{{- $ := . -}}

top:
  {{ $ | toYaml | nindent 2 }}

name: {{ include "accelleran.common.fullname" (dict "top" $) }}-server

{{- $config := .Values.config }}

# Define required variables
{{- $requiredVariables := list
  "defaultOranNamespace"
  "kafkaURL"
  "kafkaPort"
  "svcOrchestratorHost"
  "svcOrchestratorPort"
  "networkStateMonitorHost"
  "networkStateMonitorPort"
  "configApiHost"
  "configApiPort"
  "svcMonitorHost"
  "svcMonitorPort"
  "pcixAppPodName"
  "pcixAppPort"
  "ksqldbPodName"
  "ksqldbPort"
  "LteRadioControllerLabel"
  "draxVersionConfigmap"
  "grafanaPort"
}}

data:
  config.json: |
    {
      "production": {
        "serviceName": "{{ include "accelleran.common.service.name" (dict "top" $) }}",
        "servicePort": "{{ .Values.service.ports.http.port }}",
        "defaultServiceNamespace": "{{ tpl .Release.Namespace . }}",
        "nodeApiURL: "{{ .Values.global.kubeIp }}",
        "nodeApiPort": "{{ .Values.service.ports.http.nodePort }}",
        "topologyExpired": {{ .Values.config.topologyExpired }},
        "enable5G": {{ .Values.global.enable5G }},
        "enable4G": {{ .Values.global.enable4G }},
        "kafkaTopics": {{ .Values.config.kafkaTopics | toJson }},
        {{- range $index, $key := $requiredVariables }}
        "{{ $key }}": "{{ index $config $key | required (printf "Requires %s to be defined in values.yaml" $key) }}",
        {{- end }}
      }
    }

{{- end }}