#!/usr/bin/env bash

set -euo pipefail

NAMESPACE="atlas-system"
RELEASE_NAME="atlas-operator"
CHART_URI="oci://ghcr.io/ariga/charts/atlas-operator"

helm upgrade --install "$RELEASE_NAME" "$CHART_URI" \
  --namespace "$NAMESPACE" \
  --create-namespace \
  --wait \
  --timeout 5m \
  --atomic

kubectl wait --for=condition=established --timeout=60s crd/atlasschemas.db.atlasgo.io

kubectl rollout status deployment/atlas-operator -n "$NAMESPACE"
